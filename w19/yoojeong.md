## 스트림 처리

일괄처리는 입력의 변화가 하루가 지나야 반영된다는 문제가 있다.
실시간성이 중요한 서비스에서 이런 지연은 치명적이고, 이를 해결하기 위해 스트림 처리가 등장했다.

"스트림"이란 시간 흐름에 따라 점진적으로 생산된 데이터이다.
유닉스의 stdin / stdout, 프로그래밍 언어(느긋한 리스트(lazy lists)), 자바의 FileInputStream, TCP,오디오와 비디오 전송 등


### 이벤트 스트림 전송

||일괄처리|스트림처리|
|:--:|:--|:--|
|입력|파일|이벤트|
|변환|레코드의 연속으로 변환|텍스트문자열/JSON/이진 형태 등으로 부호화|
|소비|한번 기록하면 여러 작업에서 읽기 가능|생산자(producer/publisher)가 이벤트를 만들면 복수의 소비자(consumer, subscriber)가 처리 가능|
|식별|관련 레코드 집합을 파일 이름으로 식별|토픽이나 스트림으로 관련 이벤트를  묶는다|

이론상 DB와 폴링으로 스트리밍이 가능하지만 지연성이 낮아야할수록 폴링이 잦아지고, 커넥션 등 오버헤드가 커진다.
또한 새로운 이벤트마다 노티를 주는 방식도, 데이터베이스의 트리거를 사용할 수 있지만 기능이 제한적이다.

### 메시징 시스템

새로운 이벤트를 소비자에게 알려주는 일반적인 방법으로 메시징 시스템(messaging system)이 있다. 
메시징 시스템을 구축하는 가장 간단한 방법은 생산자와 소비자 사이에 유닉스 파이프나 TCP 연결과 같은 직접 통신 채널을 사용하는 것으로,  대부분의 메시징 시스템이 이러한 기본 모델을 확장해 사용하고 있다. 

- 소비자가 메시지를 처리하는 속도보다 생산자가 메시지를 빠르게 전송한다면?
  - 메시지를 버린다.
  - 큐에 메세지를 버퍼링한다.
  - 배압(backpressure)한다. 흐름 제어(flow control)라고도 하며 생산자가 메시지를 더 보내지 못하게 막는다.
    - 유닉스 파이프와 TCP는 배압을 사용한다.
- 노드가 죽거나 일시적으로 오프라인이 된다면 어떻게 될까? 손실되는 메시지가 있을까?
  - 지속성이 중요하다면 디스크에 기록하거나 복제본을 생성한다. 이는 비용이 든다.
  - 유실돼도 괜찮다면 같은 하드웨어에서 처리량은 높이고 지연시간은 낮출 수 있다.
 
   
