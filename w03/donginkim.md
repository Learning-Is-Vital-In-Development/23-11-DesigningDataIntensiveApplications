# 데이터를 위한 질의 언어

- SQL은 선언형 질의 언어인 반면 IMS와 코다실은 명령형 코드를 사용해 데이터 베이스에 질의한다.
    - 일반적으로 많이 사용하는 프로그래밍 언어는 명령형 언어다.
    - 명령형 언어는 특정 순서로 특정 연산을 수행하게끔 컴퓨터에게 지시한다.
- 선언형 질의 언어는 일반적으로 명령형 API보다 더 간결하고 쉽게 작업할 수 있다. 하지만 데이터베이스 엔진에 상세 구현이 숨겨져 있어 질의를 변경하지 않고도 데이터베이스 시스템의 성능을 향상시킬 수 있다.
- SQL 예제는 특정 순서를 보장하지 않아 순서가 바뀌어도 상관없다. 하지만 질의가 명령형 코드로 작성됐다면 데이터베이스는 코드가 순서에 의존하는지 여부를 확신할 수 없다.
- 선언형 언어는 종종 병렬 실행에 적합하다.
    - 결과의 패턴만 지정하기 때문이다.

## 웹에서의 선언형 질의

- CSS와 XSL은 문서의 스타일을 지정하기 위한 선언형 언어다.
- 자바스크리트에서 코어 DOM(Document Object Model) API를 사용하는 것은 명령형 접근 방식이다.

## 맵리듀스 질의

맵리듀스(MapReduce)는 컴퓨터에서 대량의 데이터를 처리하기 위한 프로그래밍 모델이다. 몽고DB, 카우치DB를 포함한 일부 NoSQL 데이터 저장소는 제한된 형태의 맵리듀스를 지원한다. 이 매커니즘은 많은 문서를 대상으로 읽기 전용(read-only) 질의를 수행할 때 사용한다.

- 맵리듀스는 선언형 질의 언어도 완전한 명령형 질의 API가 아니라 중간 정도에 있다. 질의 로직은 처리 프레임워크가 반복적으로 호출하는 조각 코드로 표현한다.
- 맵리듀스는 여러 함수형 프로그래밍 언어에 있는 map(collect 라고도 함)과 reduce(fold나 inject라고도 함) 함수를 기반으로 한다.

```sql
SELECT date_trunc('month', obersvation_timestamp) AS observation_month,
	sum(num_animals) AS total_animals
FROM observations
WHERE family = 'Sharks'
GROUP BY observation_month;
```

```java
db.collection.mapReduce({
    function map() {
        var year = this.timestamp.getFullYear();
        var month = this.timestamp.getMonth() + 1;
        emit(year + "-" + month, this.numAnimals);
    },
    function reduce(key, values) { reutrn Array.sum(values); },
    {
        query: { family: "Sharks" },
        out: "monthlySharkReport"
    }
})
```

- 쿼리에 family “Sharks”로 필터링
- 질의에 일치하는 모든 문서에 호출된다.
- 몽고DB의 map과 reduce 함수는 모두 순수(pure)함수 여야한다. 입력으로 전달된 데이터만 사용하고 추가적인 데이터베이스 질의를 수행할 수 없어야 하며 부수 효과(side effect)가 없어야 한다.

# 그래프형 데이터 모델

- 1:N (트리구조), 레코드간 관계 無 => 문서모델
- N:1, N:M 관계 => 관계형 모델
- 복잡한 N:M 관계 => **그래프형 모델**
- 문서 모델과의 공통점: 스키마리스한 특성때문에 확장성이 좋다. 변경사항을 쉽게 적용할 수 있는 유연성이 있다.

## 속성 그래프

- Neo4j, Titan, InfiniteGraph
- 요소
    - 정점
        - 고유한 식별자
        - 유출(outgoing) 간선 집합
        - 유입(incoming) 간선 집합
        - 속성 컬렉션(키-값 쌍)
    - 간선
        - 고유한 식별자
        - 간선이 시작하는 정점(꼬리 정점)
        - 간선이 끝나는 정점(머리 정점)
        - 두 정점 간 관계 유형을 설명하는 레이블
        - 속성 컬렉션(키-값 쌍)
- 특징
    - 정점은 다른 정점과 간선으로 연결된다. 특정 유형과 관련 여부를 제한하는 스키마는 없다.
    - 정점이 주어지면 정점의 유입과 유출 간선을 효율적으로 찾을 수 있고 그래프를 순회할 수 있다. 이련의 정점을 따라 앞뒤 방향으로 순회한다.
    - 다른 유형의 관계에 서로 다른 레이블을 사용하면 단일 그래프에 다른 유형의 정보를 저장하면서도 데이터 모델을 깔끔하게 유지할 수 있다.

## 사이퍼 질의 언어

- 속성 그래프를 위한 선언형 질의 언어
- Neo4j 그래프 데이터베이스용으로 제작
- 정점 : 상징적 이름 (id) 지정됨
- 간선 생성 : (꼬리노드 id) -[:간선 label]=> (머리노드 id)
- 선언형 질의이므로 Optimizer 가 알아서 수행

## SQL의 그래프 질의

- 가변 순회 경로에 대한 질의 개념은 재귀 공통 테이블 식(recursive common table expression)을 사용해서 표현할 수 있다.

## 트리플 저장소 모델

트리플 저장소 모델은 속성 그래프 모델과 거의 동등한데, 트리플 저장소에서는 모든 정보를 주어, 서술어, 목적어 처럼 매우 간단한 세부분의 구문 형식으로 저장한다.

### **시맨틱 웹**

트리플 저장소 데이터 모델은 시맨틱 웹과 완전 독립적이지만, 많은 사람들이 이 둘은 밀접한 관계가 있다고 생각한다. 시맨틱 웹은 웹 사이트는 사람이 이미 읽을 수 있는 정보를 게시하고 있으니, 컴퓨터가 읽게끔 기계가 판독 가능한 데이터로도 정보를 게시하자는 생각이다. 하지만 현실에 실현된 흔적이 없으며, 부정적 견해를 보이는 사람이 많다

### **RDF 데이터 모델**

RDF는 인터넷 전체의 데이터 교환을 위해 설계한 데이터인데, 때로는 데이터모델로 RDF를 채택하기도 한다.

### **스파클 질의 언어**

스파클(SPARQL)은 RDF 데이터 모델을 사용한 트리플 저장소 질의 언어로, 사이퍼보다 스파클을 사용하면 때로 질의문이 더 간결해진다.
