## 트랜잭션

- 트랜잭션의 개념
  - 몇개의 읽기와 쓰기를 하나의 논리적 단위로 묶는 방법
  - 전체가 성공(commit) 하거나 실패(abort, 롤백)
- 트랜잭션의 사용 이유
  - 신뢰성(내결함성)을 지닌 시스템 구현하기 위한 다양한 문제들을 단순화하는 메커니즘으로 채택
  - 오류 부분적인 실패를 걱정할 필요가 없다.
  - 동시성 문제의 해결할 수 있다.
  - 어떤 경우는 트랜잭션을 완화/사용않는 것이 안전/성능상의 이점이 있다
- 논의해봐야 할 문제
  - 동시성 문제
  - race condition
  - 격리 수준의 구현 : read commited, snapshot isolation, serialization


### 애매모호한 트랜잭션의 개념

- 전통적인 RDB : "값진 데이터"가 있는 "중대한 애플리케이션"에 필수적인 요구사항이다.
- 새로 등장한 NoSQL : 분산환경에서 높은 성능과 고가용성을 유지하려면 트랜잭션을 포기해야한다. 트랜잭션은 위 두 관점보다 훨씬 약한 보장이다.

#### ACID의 의미

> 원자성(Atomicity), 일관성(Consistency), 격리성(Isolation), 지속성(Durability)

1. 원자성(Atomicity)

여러 쓰기 작업이 하나의 원자적인 트랜잭션으로 묶여 있는데 결함 때문에 커밋(commit)될 수 없다면 abort되고 데이터베이스는 이 트랜잭션에서 지금까지 실행한 쓰기를 무시하거나 취소해야 한다.

2. 일관성(Consistency)

일관성이란 단어는 굉장히 여러 의미로 쓰인다. 

- 5장의 복제 일관성(replica consistency)과 비동기식으로 복제 시스템의 최종적 일관성(eventual consistency) 문제
- 일관성 해싱은 어떤 시스템들에서 재균형화를 위해 사용되는 파티셔닝 방법
- CAP 정리에서 일관성이란 단어는 선형성(linearizability)을 의미
- **ACID의 일관성은 불변식이 유효한 데이터베이스에서 시작하고 트랙잭션에서 실행된 모든 쓰기가 유효성을 보존한다면 불변식이 항상 만족해야 한다는 의미**


일관성은 실제로는 데이터베이스 속성이 아닌 애플리케이션의 속성이다.<br>
일관성의 아이디어는 애플리케이션의 불변식에 의존하며 일관성을 유지하도록 트랜잭션을 올바르게 정의하는 것도 애플리케이션의 책임이다.

3. 격리성(Isolation)

> race condition
![image](https://github.com/rachel5004/23-11-DesigningDataIntensiveApplications/assets/75432228/9a24a9d1-e26b-4751-b355-854915c34bcb)


격리성은 트랜잭션은 다른 트랜잭션을 방해 할 수 없는 것을 말한다. 즉, 여러 트랜잭션이 동시에 실행되었더라도 그 결과가 순차적으로 실행되엇을 때와 결과가 동일해야함을 말한다

직렬성 격리(serializable isolation)는 성능 손해를 동반하므로 현실에서는 거의 사용되지 않는다.<br>
오라클의 경우 직렬성이라는 격리 수준은 있지만 실제로는 직렬성보다 보장이 약한 스냅숏 격리를 구현한 것이다.

4. 지속성(Durability)

지속성은 트랜잭션이 성공적으로 커밋됐다면 하드웨어 결함이 발생하거나 데이터베이스가 죽더라도 트랜잭션에서 기록한 모든 데이터는 손실되지 않는다는 보장이다.<br>
지속석을 보장한다는 의미는 commit 전 다른 노드의 복제완료까지를 의미한다.

- 단일 노드 데이터베이스에서 지속성은 일반적으로 데이터가 하드디스크나 SSD 같은 비휘발성 자장소에 기록됐다는 뜻이다.
- 복제 기능이 있는 데이터베이스에서 지속성은 데이터가 성공적으로 다른 노드 몇 개에 복사됐다는 것을 의미한다.

#### 단일 객체 연산과 다중 객체 연산


### 완화된 격리 수준


#### 커밋 후 읽기
#### 스냅숏 격리와 반복 읽기
#### 갱신 손실 방지
#### 쓰기 스큐와 팬텀
