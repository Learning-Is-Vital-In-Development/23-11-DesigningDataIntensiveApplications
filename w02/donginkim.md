# Overview

- 데이터 모델은 해결하는 문제를 어떻게 생각해야 하는지에 대해서 지대한 영향을 미친다.

핵심적인 문제는 하위 계층 관점에서 데이터 모델을 표현하는 방법이다.

- 애플리케이션 개발자는 현실을 보고 객체나 데이터 구조, API를 모델링한다. 이러한 구조는 애플리케이션에 특화되어있다.
- 데이터 구조를 저장할 때는 JSON, XML, RDB 테이블, 그래프 모델 같은 범용 데이터 모델로 표현한다.
- 데이터베이스 소프트웨어 엔지니어는 JSON, XML, RDB 테이블, 그래프 모델을 메모리나 데시크 또는 네트워크 상의 바이트 단위로 표현하는 방법을 결정한다.
- 각 계층은 명확한 데이터 모델을 제공해 하위 계층의 복잡성을 숨긴다.
    - 추상화는 다른 그룹의 사람들이 효율적으로 일할 수 있게끔 한다.
- 하나의 데이터 모델만을 익히는데도 많은 노력이 필요하다.
    - 관계형 데이토 모델링 책만 해도 굉장히 많다.

# 관계형 모델과 문서 모델

- 1970년 에드카 코드(Edgar Codd)가 제안한 관계형 모델을 기반으로 한 SQL은 가장 잘 알려진 데이토 모델이다.
- 데이터는 관계(relation)로 구성되고 순서없는 튜플(tuple, row)모음이다.
- 1980년대 중반 RDBMS와 SQL은 정규화된 구조로 데이터를 저장하고 질의할 필요가 있는 사람들이 선택하는 도구가 되었다.
- RDB의 근원은 1960-1970년 메인프레임 컴퓨터에서 수행된 비즈니스 데이터 처리에 있다. 트랜잭션 처리와 일괄 처리가 그 사례이다.
- 객체 데이터 베이스는 80년대 후반 - 90년대 초반에 등장했다가 사라졌다.
- XML 데이터베이스는 2000년대 초반 등장했지만 채택이 거의되지 않았다.
- 오늘날 웹에서 볼 수 있는 대부분의 서비스는 여전히 RDB 기반이다.

## NoSQL의 탄생

- 2010년대부터 NoSQL은 관계형 모델의 우위를 뒤집으려는 시도를 하고 있다.
- Not Only SQL로 재해석된다.
- NoSQL이 생겨난 배경
    - 대규모 데이터셋이나 매우 높은 쓰기 처리량 달성을 쉽게할 수 있도록 확장성이 필요해짐
    - 상용 데이터베이스 제품보다 오픈소스 소프트웨어 선호도가 확산됨
    - RDB에서 지원하지 않는 특수 질의 동작 필요
    - RDB 제한에 대한 불만과 동적이고 표현력이 풍부한 데이터 모델의 니즈
- 미래에는 관계형 데이터 베이스와 비관계형 데이터 스토어가 같이 사용될 것이다. 이 개념을 다중 저장소 지속성(polyglot persistence)라고 한다.

## 객체 관계형 불일치

- 데이터를 관계형 테이블에 저장하려면 애플리케이션 코드와 데이터베이스 모델 객체 사이에 거추장스러운 전환 계층이 필요하다. 이러한 모델 사이의 분리를 임피던스 불일치(impedance mismatch)라고 부른다.
- 하이버네이트(Hibernate)나 액티브레코드(ActvieRecord) 같은 객체 관계형 매핑(ORM) 프레임워크는 전환계층에 필요한 보일러플레이트 코드 양을 줄이지만 두 모델간의 차이점을 완전히 숨길 수는 없다.

### 이력서 예제

- 전통적인 SQL 모델은 직위, 학력, 연락처 정보를  개별 테이블에 넣고 외래 키로 users테이블을 참조한다.
- 단일 로우에 다중 값을 저장하곤 한다.
- JSON, XML 등으로 부호화하여 애플리케이션이 구조와 내용을 해석화하는 방식이다.

일부 개발자는 JSON 모델이 애플리케이션 코드와 저장 계층 간 임피던스 불일치를 줄인다고 생각한다.

## 다대일과 다대다 관계

- 식별 정보를 변경해도 ID는 동일하게 유지할 수 있어야 한다. 하지만 의미를 가지는 경우라면 언젠가는 ID를 변경해야할 수도 있다. 이것은 쓰기 오버헤드와 불일치 위험이 있다. 이러한 중복을 제거하는 일이 데이터베이스의 정규화 이면에 놓인 핵심 개념이다.
- 중복된 데이터를 정규화하렴녀 다대일(many-to-one) 관계가 필요하다. 다대일 관계는 문서 모델에 적합하지 않다.
- 관계형 데이터베이스는 조인이 쉽기 때문에 ID로 다른 테이블의 로우를 참조하는 방식은 일반적이다.
- 애플리케이션의 초기 버전이 조인 없는(join-free) 문서 모델에 적합하더라도 애플리케이션에 기능을 추가하면서 데이터는 상호 연결되는 경향이 있다.

### 문서 데이터베이스는 역사를 반복하고 있나?

- 관계형 데이터베이스는 일상적으로 다대다 관계와 조인을 사용하지만 문서 데이터베이스와 NoSQL은 데이터베이스에서 다대다 관계를 표현하는 좋은 방법에 대한 논쟁을 열었다.
- JSON 구조와 비슷한 계층모델이 있었고 레코드 트리로 표현하는 구조였다. 하지만 다대다 관계표현은 어렵고 조인이 지원되지 않았다.
- 계층 모델의 한계를 극복하기 위해 관계형 모델과 네트워크 모델이 나왔다.

### 네트워크 모델

- 코다실(Conference on Data Systems Langugages, CODASYL)이라 불리는 위원회에서 표준화됐다.
- 계층 모델을 일반화한다. 레코드 간 연결은 외래 키보다 프로그래밍 언어의 포인터와 더 비슷하다.
- 레코드에 접근하는 유일한 방법은 최상위 레코드(root record)에서 연속된 연결 경로를 따른는 방법이다. 이를 접근 경로라고 한다.
- 접근 경로가 연결 목록의 순회와 같을 때 가장 간단하며, 다대다 관계에는 다양한 다른 경로가 레코드로 이어질 수 있고 네트워크 모델을 사용하는 프로그래머는 경로의 맨 앞에서 다양한 접근 경로를 추적해야 한다.
- 수동 접근 경로 선택은 제한된 하드웨어 성능을 효율적으로 사용할 수 있었지만 데이터베이스 질의와 갱신을 위한 코드가 복잡하고 유연하지 못한 문제가 있었다.
- 애플리케이션의 데이터 모델을 바꾸는 작업은 어려운 일이었다.

### 관계형 모델

- 관계는 단순히 튜블의 컬렉션이 전부이다. 접근 경로가 없다.
- 다른 테이블과의 외래 키 관계에 대해 신경쓰지 않고 임의 테이블에 새 로우를 삽입할 수 있었다.
- RDB의 질의 최적화기(query optimizer)는 질의의 어느 부분을 어떤 순서로 실행할지 결정하고 사용할 색인을 자동으로 결정한다. 이 선택은 실제로 접근 경로이다.
- 새로운 방식으로 데이터에 질의하고 싶은 경우 새로운 색인을 선언하기만 하면 된다. 따라서 관계형 모델은 애플리케이션에 새로운 기능을 추가하는 작업이 훨씬 쉽다.

### 문서 데이터베이스와 비교

- 다대일과 다대다 관계를 표현할 때 RDB는 문서형 데이터베이스보다 근본적으로 다르지 않다.
- 둘다 관련 항목을 고유한 식별자로 참조한다. 관계형 모델에서는 외래 키라고 부르고 문서 모델에서는 문서 참조(document reference)라고 부른다.

## 관계형 데이터베이스와 오늘날의 문서 데이터베이스

- 관계형 데이터베이스와 문서 데이터베이스를 비교하는 경우 내결함성과 동시성 처리를 포함해서 고려ㅕ해야한다.
- 문서 데이터 모델을 선호하는 주요 이유는 스키마 유연성, 지역성에 기인한 더 나은 성능 때문이다. 관계형 모델은 조인, 다대일, 다대다 관계를 더 잘 지원한다.

### 어떤 데이터 모델이 애플리케이션 코드를 더 간단하게 할까?

- 데이터가 문서와 비슷한 구조라면 문서 모델을 사용하는 것이 좋다.
    - 일대다 관계 트리로 보통 한 번에 전체 트리를 적재
- 문서와 비슷한 구조를 여러 테이블로 나누어 찢는(sharedding) 관계형 기법은 다루기 힘든 스키마와 불필요하게 복잡한 애플리케이션 코드를 발생시킨다.
- 애플리케이션에서 다대다 관계를 사용한다면 문서 모델은 매력이 떨어진다. 따라서 조인의 필요성이 많아지면 복잡도가 높아지고 성능이 낮아진다.

### 문서 모델에서의 스키마 유연성

- 문서 데이터베이스는 종종 스키마리스(schemaless)로 불리지만 이는 오해의 소지가 있다.
    - 어느정도의 구조 유형을 제공한다.
- 문서 모델은 쓰기 스키마(schema-on-write)와 반대되는 읽기 스키마(schema-on-read)이다.
    - 쓰키 스키마는 관계형 데이터베이스의 전통적인 접근 방식으로 명시적이고 쓰여진 모든 데이터가 스키마를 따르고 있음을 보장한다.
    - 읽기 쓰키마는 데이터 구조는 암묵적이며 데이터를 읽을 때만 해석된다고 한다.
- MySQL은 Alter Table 시에 전체 테이블을 복사한다. 이는 큰 테이블을 변경할 때 수 분에서 수 시간까지 중단시간이 발생한다.

### 질의를 위한 데이터 지역성

- 저장소 지역성(storage locality)을 활용하면 성능 이점이 있다.

### 문서 데이터베이스와 관계형 데이터베이스의 통합

# 데이터를 위한 질의 언어

# 정리
