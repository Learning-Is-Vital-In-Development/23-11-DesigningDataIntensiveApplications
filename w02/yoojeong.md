## 데이터 모델과 질의 언어

### 학습할 내용

데이터 저장과 질의를 위한 다양한 범용 데이터 모델을 살펴본다. (관계형 모델, 문서 모델, 그리고 몇 가지 그래프 기반 데이터 모델)

다양한 질의 언어를 살펴보고 사용 사례를 비교한다.

 ### 관계형 모델과 문서 모델

- 오늘날 사용하는 대부분의 데이터 모델은 관계형 모델을 기반으로 하는 SQL이다.
- 데이터(SQL의 테이블)는 **관계(relation)**로 구성되고 각 관계는 순서 없는 **튜플(tuple)**(SQL의 로우)모음이다. 
- 사용 사례 : `트랜잭션 처리`(은행 거래, 항공 예약, 창고 재고 보관..), `일괄 처리`(고객 송장 작성, 급여 지불, 보고..)


#### NoSQL의 탄생

- Not Only SQL
- NoSQL 의 사용 이유
  - 대규모 데이터셋이나 매우 높은 쓰기 처리량 달성을 관계형 데이터베이스보다 쉽게 할 수 있는 확장성의 필요
  - 상용 데이터베이스 제품보다 무료 오픈소스 소프트웨어에 대한 선호도 확산
  - 관계형 모델에서 지원하지 않는 특수 질의 동작
  - 관계형 스키마의 제한에 대한 불만과 더욱 동적이고 표현력이 풍부한 데이터 모델에 대한 바람
- 애플리케이션의 다양한 요구사항 중에서는 RDB로 만족시킬 수 없는 요구사항들이 있고, 이러한 요구사항을 NoSQL이 충족시켜줄 수 있다.
- 현재는 NoSQL과 RDB가 같이 사용되고 있으며 이런 개념을 다중저장소 지속성(polyglot persistence)라 한다.

### 객체 관계형 불일치

- 데이터를 관계형 테이블에 저장하려면 어플리케이션 코드와 데이터베이스 모델 객체 사이에 거추장스러운 전환 계층이 필요하다
- 이런 모델 사이의 분리를 impedance mismatch 라고 부ㅡ른다.
- 이러한 작업을 위해 객체 관계형 매핑(ORM) 프레임워크를 사용하기도 하지만 두 모델간의 차이를 완벽히 숨길 수 없다.

| 데이터 | RDB | JSON|
|:--:|:--:|:--:|
|![image](https://github.com/rachel5004/23-11-DesigningDataIntensiveApplications/assets/75432228/85367e16-39be-4faa-b1b7-58915458a91b)|![image](https://github.com/rachel5004/23-11-DesigningDataIntensiveApplications/assets/75432228/4b964e82-ad30-4b8e-b5fe-d95dc31095aa)|![image](https://github.com/rachel5004/23-11-DesigningDataIntensiveApplications/assets/75432228/50a92376-6155-4b5e-a0f5-99048b325808)|


- 프로필의 경우, 고유 식별자인 user_id로 식별하고, first_name, last_name 같은 경우는 사람마다 정확히 하나씩 있어 정형화가 가능하다.
- 하지만 사람마다 경력, 학력, 기간, 횟수 모두 다르기에 1:N 관계로 나타낼 수 있으며, 이 관계는 다양한 방법으로 나타낼 수 있다.
- 이력서 같은 데이터 구조는 모든 내용을 갖추고 있는 문서라서 JSON 표현에 매우 적합하다.
- JSON 표현은 다중 테이블 스키마보다 더 나은 지역성을 갖는다.
- 관계형 예제에서 프로필을 가져오려면 다중 질의 혹은 다중 조인을 수행해야 하지만 JSON 표현에서는 모든 관련 정보가 한 곳에 있어 질의 하나로 충분하다.

### 다대일과 다대다 관계

- id나 텍스트 문자열의 평문 저장 여부는 ‘중복’과 관련있다.
  -  id를 사용하는 경우 사람에게 의미있는 정보는 한 곳에만 저장하고 그것을 참조하는 모든 것은 id를 사용
  -  텍스트는 저장한다면 그것을 사용하는 모든 레코드에서 사람을 의미하는 정보를 중복해서 저장
- id 자체는 아무런 의미가 없기 떄문에 식별 정보를 변경해도 id는 변경할 필요가 없다
  - id 자체가 의미를 가진다면 변경 가능성이 있고, 만약 정보가 중복돼 있으면 모든 중복 항목을 변경해야 한다.
  - 쓰기 오버헤드와 불일치 위험이 있어 이런 중복을 제거하는 일이 데이터베이스의 정규화 이면에 놓인 핵심 개념이다.
- 중복된 데이터를 정규화하려면 다대일(many-to-one) 관계가 필요한데 문서 모델에는 다대일 관계가 적합하지 않다.
  - RDB 에서는 조인이 쉽기 때문에 id로 다른 테이블의 로우를 참조하는 방식
  - Document 에서는 1:N 트리 구조를 위해 조인이 필요하지 않지만 조인에 대한 지원이 약함
   


### 문서 데이터베이스는 역사를 반복하고 있나?

RDB 는 일상적으로 N:M 관계와 조인을 사용하지만
Document 는 데이터베이스에서 N:M 관계를 표현하는 데 어렵다.

이러한 논란은 가장 초기의 전산화 데이터베이스 시스템에도 있었다.


#### IBM의 계층 모델 (IMS)

- 계층모델은 문서 데이터베이스에서 사용하는 JSON 모델과 비슷
- JSON 구조와 마찬가지로 중첩된 레코드 트리로 표현
- Document 처럼 1:N 관계에서는 잘 동작하나 N:M 관계 표현은 어려웠고 조인은 지원하지 않았다

#### 네트워크 모델 (코다실 모델)

- 계층 모델의 트리구조에서 모든 레코드는 하나의 부모가 있지만 코다실 모델에서의 레코드는 다중 부모가 있을 수 있다. (다대일과 다대다 관계를 모델링 가능)
- 레코드에 접근하는 유일한 방법은 최상위 레코드에서부터 연속된 연결 경로(접근경로)를 따르는 방법
- 만약 레코드가 다중 부모를 가진다면 어플리케이션 코드는 모든 관계를 추적해야한다
- 원하는 데이터에 대한 경로가 없다면 접근 경로를 변경할 수 있지만 아주 많은 질의 코드를 살펴봐야 하고 새로운 접근경로를 다루기 위해 재작성해야 한다 (공수가 큼)

#### 관계형 모델

- 관계형 모델이 하는 일은 알려진 모든 데이터를 배치하는 것
- 관계는 튜플(로우)의 컬렉션이 전부로, 복잡한 중첩 구조나, 접근 경로도 없다.
- RDB 의 질의 최적화기(query optimizer)는 질의의 영역, 순서를 결정하고 사용할 색인을 자동으로 결정하며 새로운 색인을 선언하면 자동으로 적합한 색인을 사용
- 새로운 방식으로 데이터에 질의하고 싶은 경우 새로운 색인을 선언하기만 하면 질의는 자동으로 가장 적합한 색인을 사용
- 새로운 색인을 사용하기 위해 질의를 바꿀 필요가 없기 때문에 새로운 기능을 추가하는 작업이 훨씬 쉽다

#### 문서 데이터베이스와의 비교

- Document 는 별도의 테이블이 아닌 상위 레코드 내에 중첩 구조를 저장하는 측면에서 계층 모델과 유사
- 하지만 다대일과 다대다 관계를 표현할 때는 RDB 와 근본적으로 다르지 않게 고유한 식별자로 참조
  - RDB : **외래 키**
  - Document : **문서 참조**
