# Ch2 데이터 모델과 질의 언어(관계형 모델과 문서 모델)

## 관계형 모델과 문서 모델

관계형 데이터베이스 근원

- 비즈니스 데이터 처리
- 트랜잭션 처리
- 일괄 처리

### NoSQL 의 탄생

Not Only SQL

- 대규모 데이터셋이나 매우 높은 쓰기 처리량 달성을 관계형 데이터베이스보다 쉽게 할 수 있는 뛰어난 확장성의 필요
- 상용 데이터베이스 제품보다 무료 오픈소스 소프트웨어에 대한 선호도 확산
- 관계형 모델에서 지원하지 않는 특수 질의 동작
- 관계형 스키마의 제한에 대한 불만과 더욱 동적이고 표현력이 풍부한 데이터 모델에 대한 바람

가까운 미래에는 관계형 데이터베이스가 비관계형 데이터스토어와 함께 사용될 것이다. 이런 개념을 **다중 저장소 지속성** 이라 한다.

### 객체 관계형 불일치

데이터를 관계형 테이블에 저장하려면 전환 계층이 필요하다. 이런 모델 사이의 분리를 종종 **임피던스 불일치(impedance mismatch)** 라고 부른다.

JSON 으로 데이터를 저장하면 복잡한 테이블간 조인 없이 한 번의 질의로 모든 정보를 가져올 수 있다.

평문으로 데이터를 저장하는 것보다 ID 를 만들어 데이터를 저장하면 다음과 같은 장점이 있다.

- 프로필 간 일관된 스타일과 철자
- 모호함 회피
- 갱신의 편의성
- 현지화 지원
- 더 나은 검색

또한 ID 를 사용하는 경우 ID 자체는 아무런 의미가 없기 때문에 변경할 필요가 없다. 즉, 식별 정보를 변경해도 ID 는 동일하게 유지할 수 있다. 주민등록번호가 한가지 예이다.

중복된 데이터를 정규화하려면 다대일 관계가 필요한데 다대일 관계는 문서 모델에 적합하지 않다. 또한 문서형 데이터베이스는 조인에 대한 지원이 보통 약하다.

데이터베이스 자체가 조인을 지원하지 않으면 애플리케이션 코드에서 조인을 흉내 내야 한다.

더욱이 애플리케이션의 초기 버전이 조인 없는 문서 모델에 적합하더라도 애플리케이션에 기능을 추가하면서 데이터는 점차 상호 연결되는 경향이 있다.

### 네트워크 모델

네트워크 모델은 코다실이라는 위원회에서 표준화했고, 코다실 모델이라고도 부른다. 계층 모델을 일반화하는 코다실 모델에서는 하나의 레코드에 다중 부모가 있을 수 있다. 하지만 레코드가 다중 부모를 가진다면 애플리케이션
코드는 다양한 관계를 모두 추적해야 했고, 코다실 위원회도 이 방식이 n차원 데이터 공간을 항해하는 것 같다고 인정했다. 애플리케이션의 데이터 모델을 바꾸는 작업이 매우 어려운 일이 되면서, 네트워크 모델은 점점
잊혀졌다.

### 관계형 모델

대조적으로 관계형 모델이 하는 일은 알려진 모든 데이터를 배치하는 것이다. 관계(테이블)은 단순히 튜블(로우)의 컬렉션이 전부다. 얽히고설킨 중첩 구조와 데이터를 보고 싶을 때 따라가야 할 복잡한 경로가 없다.

관계형 모델에도 네트워크 모델처럼 "접근 경로"가 필요하다. 하지만 큰 차이점은 접근 경로를 애플리케이션 개발자가 아니라 질의 최적화기(query optimizer)가 자동으로 만든다는 점이다. 개발자는 따로 접근
경로를 생각할 필요가 없다.

### 문서 데이터베이스와의 비교

문서 데이터베이스는 별도 테이블이 아닌 상위 레코드 내에 중첩된 레코드를 저장한다.

하지만 다대일과 다대다 관계를 표현할 때 관계형 데이터베이스와 문서 데이터베이스는 근본적으로 다르지 않다. 둘 다 관련 항목은 고유한 식별자로 참조한다. 관계형 모델에서는 **외래 키**라고 부르고 문서 모델에서는
**문서 참조(document reference)** 라 부른다. 이 식별자는 조인이나 후속 질의를 사용해 읽기 시점에 확인한다. 현재까지는 문서 데이터베이스가 코다실의 전철을 밟지 않고 있다.

## 관계형 데이터베이스와 오늘날의 문서 데이터베이스

문서 데이터 모델을 선호하는 이유

- 스키마 유연성
- 지역성에 기인한 더 나은 성능
- 일부 애플리케이션의 경우 애플리케이션에서 사용하는 데이터 구조와 더 가깝기 때문

관계형 데이터 모델을 선호하는 이유

- 조인, 다대일, 다대다 관계를 문서 모델에 비해 더 잘 지원

### 어떤 데이터 모델이 애플리케이션 코드를 더 간단하게 할까?

데이터가 문서와 비슷한 구조(일대다 관계 트리로 보통 한 번에 전체 트리를 적재)라면 문서 모델을 사용하는 것이 좋다.

다대다 관계를 사용한다면 관계형 데이터베이스를 사용하는 것이 좋다. 문서 모델에서 비정규화로 조인의 필요성 줄이기가 가능하지만 애플리케이션 코드는 비정규화된 데이터의 일관성을 유지하기 위해 추가 작업을 해야 한다.

상호 연결이 많은 데이터의 경우, 문서형 모델은 곤란하지만 관계형 모델은 무난하며 그래프 모델은 매우 자연스럽다.

### 문서 모델에서의 스키마 유연성

대부분의 문서 데이터베이스와 관계형 데이터베이스에서 지원하는 JSON은 문서의 데이터에 어떤 스키마를 강요하지 않는다. 스키마가 없다는 뜻은 임의의 키와 값을 문서에 추가할 수 있고 읽을 때 클라이언트는 문서에 포함된 필드의 존재 여부를 보장하지 않는다는 의미다.

문서 데이터베이스는 종종 **스키마리스(schemaless)** 로 불리지만 이는 오해의 소지가 있다. 데이터를 읽는 코드는 보통 구조의 유형을 어느 정도 가정한다. 즉 암묵적인 스키마가 있지만 데이터베이스는 이를 강요하지 않는다.

추가 작성

### 질의를 위한 데이터 지역성

### 문서 데이터베이스와 관계형 데이터베이스의 통합
