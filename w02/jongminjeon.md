# 2. 데이터 모델과 질의언어

- 데이터 모델: 소프트웨어가 어떻게 작성됐는지 뿐만 아니라 해결하려는 문제를 어떻게 생각해야 하는지에 대해서도 지대한 영향을 미친다.

- 대부분의 애플리케이션은 하나의 데이터 모델을 다른 데이터 모델 위에 계층을 둬서 만든다.

예시
- 애플리케이션 개발자는 현실(사람, 조직, 상품, 행동, 자금 흐름, 센서 등)을 보고 객체나 데이터 구조, 그리고 이러한 데이터 구조를 다루는 API를 모델링 한다.
- 데이터 구조를 저장할 때는 JSON, XML 문서, 관계형 데이터베이스 테이블이나 그래프 모델 같은 범용 데이터 모델로 저장 한다.
- 데이터베이스 소프트웨어를 개발하는 엔지니어는 JSON/XML/관계형/그래프 데이터를 메모리나 디스크 또는 네트워크 상의 바이트 단위로 표현하는 방법을 결정한다. 이 표현은 다양한 방법으로 데이터를 질의, 탐색, 조작, 처리할 수 있게 한다.
- 더 낮은 수준에서 하드웨어 엔지니어는 전류, 빛의 파동, 자기장 등의 관점에서 바이트를 표현하는 방법을 담당한다.

각 계층은 명확한 데이터 모델을 제공해 하위 계층의 복잡성을 숨긴다. 
그리고 이 추상화는 다른 그룹의 사람들이 효율적으로 일할 수 있도록 한다.

다양한 유형의 데이터 모델이 있고 각 데이터 모델은 사용 방법에 대한 가정이 있다.
어떤 종류의 사용법은 쉽고 어떤 동작은 지원하지 않는다. 어떤 연산은 빠르지만 어떤 연산은 매우 느리게 작동한다. 또한 어떤 데이터 변환은 자연스럽지만 다른 어떤 데이터 변환은 부자연스럽다.

위처럼 데이터 모델은 소프트웨어가 할 수 있는일과 할 수 없는일에 지대한 영향을 주므로 애플리케이션에 적합한 데이터 모델은 선택하는 작업은 상당히 중요하다.


## 2.1. 관계형 모델과 문서 모델

- 오늘날 가장 잘 알려진 데이터 모델: 관계형 모델 (Oracle, MySQL, Postgres, ...)
	- 관계형 모델은 정리된 인터페이스 뒤로 구현 세부 사항을 숨겼다 (예. 옵티마이저: 최적 질의 경로 찾기)


### 2.1.1. NoSQL의 탄생

- 관계형 모델의 우위를 뒤집으려는 시도 (오픈소스, 분산 환경, 비관계형 데이터베이스 밋업)

탄생의 원동력
- 대규모 데이터셋이나 매우 높은 쓰기 처리량 달성을 관계형 데이터베이스보다 쉽게 할 수 있는 뛰어난 확장성 필요
- 사용 데이터베이스 제품보다 무료 오픈소스 소프트웨어에 대한 선호도 확산
- 관계형 모델에서 지원하지 않는 특수 질의 동작
- 관계형 스키마의 제한에 대한 불만과 더욱 동적이고 표현력이 풍부한 데이터 모델에 대한 바람

가까운 미래에는 관계형 데이터베이스가 폭넓은 다양함을 가진 비관계형 데이터스토어와 함께 사용될 것이다.
- 예: RDBMS + Redis + Mongo


### 2.1.2.  객체 관계형 불일치

- 데이터를 관계형 테이블에 저장하려면 애플리케이션 코드와 데이터베이스 모델 객체(테이블, 로우, 컬럼) 사이에 거추장스러운 전환계층이 필요 (임피던스 불일치)

이력서를 위한 데이터 예시
1. 전통적인 SQL 모델: 유저, 직위, 학력, 연락처 정보 테이블
	-  유저 테이블과 1: N관계의 다수 테이블 생성
2. SQL3(SQL:1999): 단일 Row에 다중 값 저장을 지원해 1:N 관계 표현 (XML, JSON 타입 등)
3. JSON이나 XML 문서로 저장 후 애플리케이션이 구조와 내용을 해석하게하는 방법 
	- 다중 테이블 보다 더 나은 지역성(Locality)를 갖는다.
	- 애플리케이션 코드와 저장 계층 간 임피던스 불일치를 줄인다. (4장에서 문제점)

### 2.1.3. 다대일과 다대다 관계

아래 처럼 지역, 산업군을 나타낼 때 평문이 아닌 ID로 표기 했을 때의 장점
- region_id: 91 (그레이터 시애틀)
- industry_id: 123 (자선활동)

- 프로필 간 일관된 스타일과 철자
- 모호함 회피 (같은 이름의 도시가 있을 경우, 우리나라도 북구, 중구와 같은 시군구가 중복)
- 갱신의 편의성 (이름이 한곳에만 저장되기에 변경하기 쉬움)
- 현지화 지원
- 더나은 검색 (시애틀이 워싱턴에 있다는 사실을 부호화 할 수 있음)

문서데이터베이스는 보통 조인에 대한 지원이 약하다.
원하는 조인을 지원하지 않으면 데이터베이스에 다중 질의 요청을 하고 애플리케이션에서 조인해야 한다.
(최적화 하기 힘들고, )



### 2.1.4. 문서 데이터베이스는 역사를 반복하고 있나?

1970년대 비즈니스 데이터 처리를 위해 가장 많이 사용한 데이터베이스: IBM의 정보관리시스템(Information Management System, IMS)

IMS의 설계는 계층 모델이라 부르는 상당히 간단한 데이터 모델을 사용했고 오늘날 문서데이터베이스에서 사용하는 JSON 모델과 비슷하다.

문서데이터베이스 처럼 일대다 관계에는 잘 동작하지만 다대다 관계 표현은 어렵고 조인은 지원하지 않았다.
개발자는 비정규화된 데이터의 중복을 유지할지 참조해서 해결할지 결정해야 했다.

IMS(계층 모델)의 한계를 극복하기 위해 관계형 모델, 네트워크 모델이 해결책으로 나왔었다.


#### 2.1.4.1. 네트워크 모델

네트워크 모델은 코다실(Conference on Data Systems Languages, CODASYL)이라 불리는 위원회에서 표준화해서 코다실 모델이라고도 부름

- 계층 모델: 트리 구조에서 모든 레코드는 정확하게 하나의 부모가 있음
- 네트워크 모델: 레코드는 다중 부모가 있을 수 있음

다중 부모가 있는 레코드가 다양한 관계를 모두 추적하기에 수많은 접근 경로가 있고 프로그래머는 다양한 접근 경로를 추적해야 했음 (힘든일)


#### 2.1.4.2. 관계형 모델

알려진 모든 데이터터를 배치 후 조건에 따라 읽어오고 조인해서 사용
- 데이터의 접근 경로는 옵티마이저가 만들어주기에 프로그래머는 접근 경로를 고민할 필요가 없음
- 인덱스만 추가하면 적합한 인덱스를 사용 (대부분 쿼리를 변경할 필요 없이)


#### 2.1.4.3. 문서 데이터베이스와의 비교

문서 데이터베이스는 한 가치 측면에서 계층 모델로 돌아감: 별다 테이블이 아닌 중첩된 레코드를 저장 (일대다)

다대일과 다대다 관계를 표현할 때 관계형 데이터베이스와 문서 데이터베이스 모두 고유한 식별자로 참조
- 관계형 모델: 외래 키
- 문서 데이터베이스: 문서 참조


### 2.1.5. 관계형 데이터베이스와 오늘날의 문서 데이터베이스

관계형 데이터베이스와 문서 데이터베이스를 비교하는 경우 내결함성(5장), 동시성 처리(7장)를 포함해 고려해야할 차이점이 많음

일반적으로 문서 데이터 모델을 선호하는 주요이유는 스키마 유연성, 지역성에 기인한 더나은 성능, 일부 애플리케이션의 경우 애플리케이션에서 사용하는 데이터 구조와 더 가깝기 때문

관계형 모델은 조인, 다대일, 다대다 관계를 더 잘 지원

#### 2.1.5.1. 어떤 데이터 모델이 애플리케이션 코드를 더 간단하게 할까?

애플리케이션의 데이터가 문서와 비슷한 구조라면 문서 모델이 사용하는 것이 좋음
문서와 비슷한 구조를 여러 테이블로 나누는 관계형 기법은 복잡

문서 데이터베이스의 미흡한 조인 지원 (중첩 항목을 바로 참조할 수 없어 사용자 251의 직위 두번째 항목과 같이 표현) 은 조인이 필요없는 상황이라면 문제가 없을 수 있음

하지만 애플리케이션에서 다대다 관계로 조인을 많이해야한다면 문서 모델의 매력은 떨어짐
비정규화로 조인 횟수를 줄일 수는 있겠지만 비정규화된 데이터의 일관성 유지를 위해 추가작업을 해야함
또한 조인을 애플리케이션 코드에서 구현했을 때 복잡도가 높아지고 조인 성능도 RDMS에 비해 떨어짐

상호 연결이 많은 데이터의 경우 문서모델은 곤란하지만 관계형 모델은 무난하며 그래프 모델은 매우 자연스러움


#### 2.1.5.2. 문서 모델에서의 스키마 유연성

스키마 유연성이 장점이 될 때
- 다른 유형의 오브젝트가 있고 각 유형의 오브젝트를 자체 테이블에 넣는 방법이 실용적이지 않을 때
- 사용자가 제어할 수 없고 언제나 변경 가능한 외부 시스템에 의해 데이터 구조가 결정 될 때


모든 레코드가 동일한 구조라서 예상 가능하다면 스키마가 문서화와 구조를 강제하기 위해 유용한 메커니즘임


#### 2.1.5.3. 질의를 위한 데이터 지역성

문서는 보통 JSON, XML의 부호화된 단일 연속 문자열이나 이진변형으로 저장됨
애플리케이션이 자주 전체 문서에 접근해야 한다면 저장소 지역성에 따라 성능 이점이 있음
- 데이터가 여러 테이블에 나눠져 있으면 검색을 위해 더 많은 디스크 탐색과 시간 소요


#### 2.1.5.4. 문서 데이터베이스와 관계형 데이터베이스의 통합

대부분의 관계형 데이터베이스 시스템은 XML, JSON 기능을 지원해 문서 데이터베이스를 사용할 때와 비슷한 데이터 모델을 애플리케이션에서 사용할 수 있음

문서 데이터베이스도 조인을 지원함 (클라이언트 사이트 조인)

관계형 데이터베이스와 문서 데이터베이스는 시간이 지남에 따라 점점 더 비슷해지고 있고 각 데이터 모델이 서로 부족한 부분을 보완해 나가고 있음





--- 
## 2.2. 데이터를 위한 질의 언어

## 2.3. 그래프형 데이터 모델
