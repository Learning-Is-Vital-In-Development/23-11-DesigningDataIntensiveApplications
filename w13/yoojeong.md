## 분산 시스템의 골칫거리

### 결함과 부분 장애

분산 시스템에서는 전체가 아닌 어떤 부분만 예측할 수 없는 방식으로 고장날 수도 있는데, 이를 부분 장애(partial failure) 라고 한다. 

#### 클라우드 컴퓨팅과 슈퍼 컴퓨팅

- 고성능 컴퓨팅(high-performance coimputing, HPC)
  - 슈퍼 컴퓨터는 보통 일기예보나 분자 동력학처럼 비용이 큰 과학 계산 작업에 쓰인다
  - 결함 처리 방식
    - 가끔씩 계산 상태를 지속성 있는 저장소에 체크포인트로 저장
    - 노드 하나에 장애가 발생했을 때는 그냥 전체 클러스터 작업부하를 중단
    - 장애가 발생한 노드가 복구된 후 마지막 체크포인트로부터 계산을 재시작
  - 분산 시스템보다는 단일 노드 컴퓨터에 가깝다
- 클라우드 컴퓨팅
  - 멀티 테넌트 데이터센터, IP 네트워크로 연결된 상용 컴퓨터, 신축적(elastic)/주문식(on-demand) 자원할당, 계량 결제(metered billing)..
  - 결함 처리 방식
    - 인터넷 관련 애플리케이션은 사용자에게 지연 시간이 낮은 서비스를 제공해야 하기 때문에 클러스터 중단을 할 수 없다
    - 상용 장비를 사용해 구축하는데, 규모의 경제를 이유로 비용대비 높은 성능을 제공하지만 실패율도 높다
    - 지리적으로 분산된 배포를 할 때 통신은 인터넷을 거치기에 로컬에 비해 느리고 신뢰성도 떨어진다  
    - 데이터센터의 네트워크는 IP와 이더넷을 주로 기반으로 하며 높은 양단 대역폭(bisection bandwidth)을 제공하기 위해 클로스 토폴로지(Clos topology)로 연결돼 있다.

결함 처리는 소프트웨어 설계의 일부여야 하며, 결함이 발생하면 어떻게 동작할지도 알아야 한다.

### 신뢰성 없는 네트워크

> (a)요청손실 (b)노드장애 (c)응답손실, 요청 이후 응답이 오지 않을 때 무엇이 원인인지 알 수 없음
![image](https://github.com/rachel5004/23-11-DesigningDataIntensiveApplications/assets/75432228/4795ed77-1fd0-41b3-bc26-c27d48c71500)

이 문제를 다루는 흔한 방법은 타임아웃 이다. 그러나 타임아웃이 발생했을 때 원격 노드가 응답을 받았는지 아닌지는 여전히 알 수 없다.


#### 현실의 네트워크 결함

네트워크 결함의 원인은 다양하기 때문에 네트워크 결함을 반드시 견뎌낼 필요는 없고, 중요한 점은 결함의 가능성을 인지하는것이다.

네트워크 문제가 발생하면 어떻게 반응하는지 알고, 복구할 수 있도록 보장해야 한다.

고의로 네트워크 문제를 유발하고 시스템을 테스트하는것도 좋다. (카오스 엔지니어링)

#### 결함 감지

시스템은 결함이 있는 노드를 자동으로 감지할 수 있어야 한다.

- 로드 밸런서는 죽은 노드로 요청을 그만 보내야 한다.
- 단일 리더 복제를 사용하는 분산 데이터베이스에서 리더에 장애가 나면 팔로워 중 하나가 리더가 되어야 한다.
