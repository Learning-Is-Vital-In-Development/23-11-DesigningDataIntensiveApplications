# 09. 일관성과 합의

- 결함을 다루는 가장 간단한 방법은 전체 서비스가 실패하도록 두고 사용자에게 오류 메시지를 보여주는 것이다.
- 이 외에는 내부 구성 요소 중 뭔가에 결함이 있더라도 서비스가 올바르게 동작하게할 견뎌낼(tolerating) 방법을 구축하는 것이다.
- 내결함성을 지닌 시스템
    - 유용한 보장 범용 추상화를 찾아 이를 구현하고 애플리케이션에게 이 보장에 의존
        - 트랜잭션을 사용하면 원자성, 격리성, 지속성의 문제에 대한 걱정을 하지 않게 해준다.
    - 노드들의 합의를 통해 새 리더를 뽑는 방법
        - 스플릿 브레인(split brain)등의 문제를 피할 수 있다.

## 일관성 보장

동시에 데이터베이스 노드 2개 이상을 보면 다른 데이터를 볼 수 있다. 각 노드들에게 쓰기 요청이 도착하는 시간이 다르기 때문이다.

**최종적 일관성**

- 복제 데이터베이스
    - 결국 모든 읽기 요청이 같은 값을 반환하게 되는 것
    - 언제 복제본의 값이 같은 값으로 수렴할지 보장하지 않는다.
- 애플리케이션 개발자에게 어려움
    - 에지케이스를 발견하기 어렵다.
        - 동시성이 높거나 시스템 결함(네트워크 끊김 등)이 있을 때 분명히 드러난다.

분산 일관성 모델은 트랜잭션 격리 수준 계층과 비슷한 점이 있다.

- 트랜잭션 격리는 동시에 실행되는 트랜잭션 때문에 발생하는 경쟁 조건을 회피하는 것에 관한 이야기이다.
- 분산 일관성은 대개 지연과 결함이 이썯라도 복제본의 상태를 코디네이션하는 것에 관한 이야기이다.

앞으로 볼 내용

- 공통적으로 사용하는 강한 일관성 모델 중 하나인 **선형성(linearizability)**을 살펴보고 장점과 단점을 검토
- 분산 시스템에서 이벤트 순서화 문제, 특히 인과성과 전체 순서화와 관련된 문제를 검토
